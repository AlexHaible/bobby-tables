#!/usr/bin/perl -w

use strict;
use warnings;

use Carp::Always;
use Getopt::Long;
use File::Slurp;

use Text::Textile;

my $sourcepath   = 's';
my $buildpath = 'build';

GetOptions(
    'sourcepath:s' => \$sourcepath,
    'buildpath:s'  => \$buildpath,
) or exit;

-d $buildpath && -w $buildpath or die;

my $tt = new Text::Textile;
$tt->flavor( 'xhtml1' );

my @sidelinks;

my $pages = [
    index      => 'Home',

    asp        => 'ASP',
    coldfusion => 'ColdFusion',
    csharp     => 'C#',
    delphi     => 'Delphi',
    dotnet     => '.NET',
    java       => 'Java',
    python     => 'Python',
    ruby       => 'Ruby, Ruby on Rails',
];

$pages = [
    index => 'Home',
    java => 'Java',
];

my @pages = @{$pages};
while ( @pages ) {
    my ($section,$desc) = splice( @pages, 0, 2 );
    my $htmlfile = "$section.html";
    push( @sidelinks, {
        filename => $htmlfile,
        text     => $desc,
    } );
}

@pages = @{$pages};
while ( @pages ) {
    my ($section,$desc) = splice( @pages, 0, 2 );
    my $textile = read_file( "$sourcepath/$section.textile" );
    my $html    = $tt->process( $textile );
    write_file( "$buildpath/$section.html", $html );
}
